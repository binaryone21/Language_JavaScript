<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #loading {
            width: 100px;
            height: 100px;
            background: url(img/loading.gif) no-repeat center/cover;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            display: none;
        }
        #loading.active {
            display: block;
        }
    </style>
</head>
<body>
    <div id="loading"></div>
    <h1>우편번호 검색</h1>
    <input type="text" id="keyword"/>
    <button id="btn" type="button">데이터 가져오기</button>

    <hr/>

    <table border="1">
        <thead>
            <tr>
                <th>우편번호</th>
                <th>도로명주소</th>
                <th>지번주소</th>
            </tr>
        </thead>
        <tbody id="list-body"></tbody>
    </table>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        document.querySelector("#btn").addEventListener('click', async (e) => {
            // 로딩바 표시하기
            const loading = document.querySelector("#loading");
            loading.classList.add("active");

            // 사용자 입력값
            const userInput = document.querySelector("#keyword").value.trim();

            if(!userInput) {
                alert("검색어를 입력해주세요.");
                document.querySelector("#keyword").focus();
                return;
            }

            // 요청할 OpenAPI의 주소
            const url = "https://business.juso.go.kr/addrlink/addrLinkApi.do";

            // Ajax 응답 결과를 저장할 JSON
            let response = null;
            try {
                response = await axios.get(url, {
                    // "이름=값&이름=값..." 형식의 QueryString 을 JSON 형식으로 재구성
                    params : {
                        // 이름 : 값
                        confmKey : "devU01TX0FVVEgyMDIzMTEwODIxMTQwMTExNDI1NjQ=",
                        currentPage : 1,
                        countPerPage : 50,
                        keyword : userInput,
                        resultType : "json"
                    },
                });
            } catch(error) {
                alert(error);
            } finally {
                loading.classList.remove("active");
            }

            const listBody = document.querySelector("#list-body");

            console.log(response.data.results);
            response.data.results.juso.forEach((v, i) => {
                const tr = document.createElement("tr");
                const td1 = document.createElement("td");
                td1.innerHTML = v.zipNo;
                const td2 = document.createElement("td");
                td2.innerHTML = v.roadAddr;
                const td3 = document.createElement("td");
                td3.innerHTML = v.jibunAddr;

                tr.appendChild(td1);
                tr.appendChild(td2);
                tr.appendChild(td3);
                listBody.appendChild(tr);
            });
        });
    </script>
</body>
</html>
<!--
개발 ( 사용기간 : 2023-11-08 ~ 2024-02-06 )
https://business.juso.go.kr/addrlink/addrLinkApi.do?
confmKey=devU01TX0FVVEgyMDIzMTEwODIxMTQwMTExNDI1NjQ=&
currentPage=1&countPerPage=50&keyword='메가스터디IT아카데미'&
resultType='json'
-->